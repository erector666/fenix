<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FENIX Construction Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Import Lucide icons
        const { Clock, MapPin, Camera, Play, Pause, Square, Car, Fuel, Users, Calendar, BarChart3, Settings, LogOut } = lucide;

        // React-like state management
        let currentUser = null;
        let isAdmin = false;
        let currentView = 'login';
        let workSession = null;
        let location = null;
        let employees = [
            { id: 1, name: 'John Doe', email: 'john@fenix.com', password: 'worker123' },
            { id: 2, name: 'Jane Smith', email: 'jane@fenix.com', password: 'worker123' },
            { id: 3, name: 'Mike Johnson', email: 'mike@fenix.com', password: 'worker123' }
        ];
        let workLogs = [];
        let vehicles = [
            { id: 1, name: 'Van #1', plate: 'ABC-123' },
            { id: 2, name: 'Van #2', plate: 'DEF-456' },
            { id: 3, name: 'Truck #1', plate: 'GHI-789' },
            { id: 4, name: 'Personal Car', plate: 'Own Vehicle' }
        ];

        // Render function
        function render() {
            const root = document.getElementById('root');
            
            if (currentView === 'login') {
                root.innerHTML = renderLoginForm();
                setupLoginHandlers();
            } else if (currentView === 'admin') {
                root.innerHTML = renderAdminDashboard();
                setupAdminHandlers();
            } else if (currentView === 'employee') {
                root.innerHTML = renderEmployeeDashboard();
                setupEmployeeHandlers();
            }
        }

        // Login Form
        function renderLoginForm() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
                        <div class="text-center mb-8">
                            <div class="mb-4">
                                <img src="fenix.png" alt="FENIX Logo" class="mx-auto max-w-[200px] max-h-[100px] object-contain" />
                            </div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">FENIX</h1>
                            <p class="text-gray-600">Construction Tracker</p>
                        </div>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input
                                    type="email"
                                    id="email"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                                    placeholder="Enter your email"
                                    required
                                />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input
                                    type="password"
                                    id="password"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                                    placeholder="Enter your password"
                                    required
                                />
                            </div>
                            
                            <button
                                onclick="handleLogin()"
                                class="w-full bg-orange-500 text-white py-2 px-4 rounded-md hover:bg-orange-600 transition duration-200"
                            >
                                Login
                            </button>
                        </div>
                        
                        <div class="mt-6 text-sm text-gray-600 text-center">
                            <p>Demo Credentials:</p>
                            <p>Admin: admin@fenix.com / admin123</p>
                            <p>Worker: john@fenix.com / worker123</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function setupLoginHandlers() {
            // Add enter key handler
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
        }

        function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // Check for admin login
            if (email === 'admin@fenix.com' && password === 'admin123') {
                currentUser = { id: 0, name: 'Admin', email: 'admin@fenix.com' };
                isAdmin = true;
                currentView = 'admin';
                render();
                return;
            }

            // Check for employee login
            const employee = employees.find(emp => emp.email === email && emp.password === password);
            if (employee) {
                currentUser = employee;
                isAdmin = false;
                currentView = 'employee';
                getCurrentLocation();
                render();
            } else {
                alert('Invalid credentials');
            }
        }

        // Get current location
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        location = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            timestamp: new Date().toISOString()
                        };
                        render();
                    },
                    (error) => {
                        console.error('Error getting location:', error);
                        location = { error: 'Location not available' };
                        render();
                    }
                );
            }
        }

        // Employee Dashboard
        function renderEmployeeDashboard() {
            return `
                <div class="min-h-screen bg-gray-100">
                    <div class="bg-white shadow-sm border-b">
                        <div class="px-4 py-3 flex justify-between items-center">
                            <h1 class="text-xl font-bold text-gray-800">Welcome, ${currentUser.name}</h1>
                            <button
                                onclick="logout()"
                                class="text-gray-500 hover:text-gray-700"
                            >
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                    <polyline points="16,17 21,12 16,7"/>
                                    <line x1="21" y1="12" x2="9" y2="12"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="p-4 space-y-4">
                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-lg font-semibold">Work Status</h2>
                                <div class="px-3 py-1 rounded-full text-sm font-medium ${
                                    workSession ? 
                                        workSession.status === 'working' ? 'bg-green-100 text-green-800' :
                                        workSession.status === 'break' ? 'bg-yellow-100 text-yellow-800' : 
                                        'bg-gray-100 text-gray-800'
                                    : 'bg-gray-100 text-gray-800'
                                }">
                                    ${workSession ? 
                                        workSession.status === 'working' ? 'Working' :
                                        workSession.status === 'break' ? 'On Break' : 'Idle'
                                    : 'Not Started'}
                                </div>
                            </div>

                            ${workSession ? `
                                <div class="space-y-2 text-sm text-gray-600">
                                    <p><span class="font-medium">Started:</span> ${new Date(workSession.startTime).toLocaleString()}</p>
                                    <p><span class="font-medium">Vehicle:</span> ${workSession.vehicle?.name || 'N/A'}</p>
                                    <p><span class="font-medium">Gas:</span> ${workSession.gasAmount} L</p>
                                    <p><span class="font-medium">Screenshots:</span> ${workSession.screenshots.length}</p>
                                    <p><span class="font-medium">Breaks:</span> ${workSession.breaks.length}</p>
                                </div>
                            ` : ''}
                        </div>

                        <div class="bg-white rounded-lg shadow p-4">
                            <div class="flex items-center mb-2">
                                <svg class="text-orange-500 mr-2" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                                <h3 class="font-semibold">Current Location</h3>
                            </div>
                            <p class="text-sm text-gray-600">
                                ${location ? 
                                    location.error ? 
                                        `<span class="text-red-500">${location.error}</span>` :
                                        `${location.latitude.toFixed(6)}, ${location.longitude.toFixed(6)}`
                                    : 'Getting location...'
                                }
                            </p>
                        </div>

                        <div class="space-y-3">
                            ${!workSession ? `
                                <button
                                    onclick="startWork()"
                                    class="w-full bg-green-500 text-white py-4 px-6 rounded-lg flex items-center justify-center space-x-2 hover:bg-green-600 transition duration-200"
                                >
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="5,3 19,12 5,21"/>
                                    </svg>
                                    <span class="font-semibold">Start Work</span>
                                </button>
                            ` : `
                                ${workSession.status === 'working' ? `
                                    <button
                                        onclick="takeBreak()"
                                        class="w-full bg-yellow-500 text-white py-4 px-6 rounded-lg flex items-center justify-center space-x-2 hover:bg-yellow-600 transition duration-200"
                                    >
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="6" y1="4" x2="6" y2="20"/>
                                            <line x1="18" y1="4" x2="18" y2="20"/>
                                        </svg>
                                        <span class="font-semibold">Take Break</span>
                                    </button>
                                ` : `
                                    <button
                                        onclick="resumeWork()"
                                        class="w-full bg-blue-500 text-white py-4 px-6 rounded-lg flex items-center justify-center space-x-2 hover:bg-blue-600 transition duration-200"
                                    >
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="5,3 19,12 5,21"/>
                                        </svg>
                                        <span class="font-semibold">Resume Work</span>
                                    </button>
                                `}

                                <button
                                    onclick="takeScreenshot()"
                                    class="w-full bg-purple-500 text-white py-4 px-6 rounded-lg flex items-center justify-center space-x-2 hover:bg-purple-600 transition duration-200"
                                >
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                                        <circle cx="12" cy="13" r="3"/>
                                    </svg>
                                    <span class="font-semibold">Take Screenshot</span>
                                </button>

                                <button
                                    onclick="endWork()"
                                    class="w-full bg-red-500 text-white py-4 px-6 rounded-lg flex items-center justify-center space-x-2 hover:bg-red-600 transition duration-200"
                                >
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    </svg>
                                    <span class="font-semibold">End Work</span>
                                </button>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function setupEmployeeHandlers() {
            // Handlers are already set up via onclick attributes
        }

        // Admin Dashboard
        function renderAdminDashboard() {
            return `
                <div class="min-h-screen bg-gray-100">
                    <div class="bg-white shadow-sm border-b">
                        <div class="px-6 py-4 flex justify-between items-center">
                            <h1 class="text-2xl font-bold text-gray-800">Admin Dashboard</h1>
                            <button
                                onclick="logout()"
                                class="text-gray-500 hover:text-gray-700"
                            >
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                    <polyline points="16,17 21,12 16,7"/>
                                    <line x1="21" y1="12" x2="9" y2="12"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="bg-white border-b">
                        <div class="px-6">
                            <nav class="flex space-x-8">
                                <button onclick="switchTab('overview')" class="flex items-center space-x-2 py-4 px-1 border-b-2 border-orange-500 font-medium text-sm text-orange-600">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 3v18h18"/>
                                        <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                                    </svg>
                                    <span>Overview</span>
                                </button>
                                <button onclick="switchTab('employees')" class="flex items-center space-x-2 py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                        <circle cx="9" cy="7" r="4"/>
                                        <path d="m22 21-2-2"/>
                                        <path d="M16 16h6"/>
                                    </svg>
                                    <span>Employees</span>
                                </button>
                                <button onclick="switchTab('reports')" class="flex items-center space-x-2 py-4 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                        <line x1="16" y1="2" x2="16" y2="6"/>
                                        <line x1="8" y1="2" x2="8" y2="6"/>
                                        <line x1="3" y1="10" x2="21" y2="10"/>
                                    </svg>
                                    <span>Reports</span>
                                </button>
                            </nav>
                        </div>
                    </div>

                    <div class="p-6">
                        <div id="overviewTab" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-white rounded-lg shadow p-6">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Active Workers</p>
                                            <p class="text-2xl font-bold text-gray-900">
                                                ${workLogs.filter(log => log.status === 'working' || log.status === 'break').length}
                                            </p>
                                        </div>
                                        <svg class="text-orange-500" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                            <circle cx="9" cy="7" r="4"/>
                                            <path d="m22 21-2-2"/>
                                            <path d="M16 16h6"/>
                                        </svg>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg shadow p-6">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Total Hours Today</p>
                                            <p class="text-2xl font-bold text-gray-900">
                                                ${workLogs
                                                    .filter(log => {
                                                        const today = new Date().toDateString();
                                                        return new Date(log.startTime).toDateString() === today;
                                                    })
                                                    .reduce((total, log) => total + calculateWorkHours(log), 0)
                                                    .toFixed(1)}
                                            </p>
                                        </div>
                                        <svg class="text-orange-500" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <polyline points="12,6 12,12 16,14"/>
                                        </svg>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg shadow p-6">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-600">Completed Jobs</p>
                                            <p class="text-2xl font-bold text-gray-900">
                                                ${workLogs.filter(log => log.status === 'completed').length}
                                            </p>
                                        </div>
                                        <svg class="text-orange-500" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M3 3v18h18"/>
                                            <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-lg shadow">
                                <div class="px-6 py-4 border-b">
                                    <h3 class="text-lg font-semibold">Recent Activity</h3>
                                </div>
                                <div class="divide-y">
                                    ${workLogs.slice(-5).reverse().map((log, index) => `
                                        <div class="px-6 py-4">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <p class="font-medium">${log.employeeName}</p>
                                                    <p class="text-sm text-gray-600">
                                                        ${log.status === 'completed' ? 'Completed work' : 
                                                          log.status === 'working' ? 'Started work' : 'On break'}
                                                    </p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-sm text-gray-600">
                                                        ${new Date(log.startTime).toLocaleString()}
                                                    </p>
                                                    ${log.status === 'completed' ? `
                                                        <p class="text-sm font-medium text-green-600">
                                                            ${calculateWorkHours(log).toFixed(1)}h
                                                        </p>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function setupAdminHandlers() {
            // Handlers are already set up via onclick attributes
        }

        // Work functions
        function startWork() {
            workSession = {
                id: Date.now(),
                employeeId: currentUser.id,
                employeeName: currentUser.name,
                startTime: new Date().toISOString(),
                startLocation: location,
                vehicle: { name: 'Default Vehicle' },
                gasAmount: 0,
                screenshots: [],
                breaks: [],
                status: 'working'
            };
            workLogs.push(workSession);
            render();
        }

        function takeBreak() {
            if (workSession) {
                workSession.breaks.push({
                    start: new Date().toISOString(),
                    location: location
                });
                workSession.status = 'break';
                render();
            }
        }

        function resumeWork() {
            if (workSession && workSession.breaks.length > 0) {
                const lastBreak = workSession.breaks[workSession.breaks.length - 1];
                lastBreak.end = new Date().toISOString();
                workSession.status = 'working';
                render();
            }
        }

        function endWork() {
            if (workSession) {
                workSession.endTime = new Date().toISOString();
                workSession.endLocation = location;
                workSession.status = 'completed';
                workSession = null;
                render();
            }
        }

        function takeScreenshot() {
            if (workSession) {
                const screenshotData = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    location: location,
                    type: 'work_progress'
                };
                
                workSession.screenshots.push(screenshotData);
                render();
                
                // Show notification
                alert('Screenshot captured!');
            }
        }

        function calculateWorkHours(log) {
            if (!log.startTime || !log.endTime) return 0;
            
            const start = new Date(log.startTime);
            const end = new Date(log.endTime);
            const totalMs = end - start;
            
            // Subtract break time
            const breakMs = log.breaks.reduce((total, breakItem) => {
                if (breakItem.start && breakItem.end) {
                    const breakStart = new Date(breakItem.start);
                    const breakEnd = new Date(breakItem.end);
                    return total + (breakEnd - breakStart);
                }
                return total;
            }, 0);
            
            return Math.max(0, (totalMs - breakMs) / (1000 * 60 * 60)); // Convert to hours
        }

        function switchTab(tabName) {
            // For now, just show overview tab
            render();
        }

        function logout() {
            currentUser = null;
            isAdmin = false;
            workSession = null;
            currentView = 'login';
            render();
        }

        // Initialize
        render();
    </script>
</body>
</html> 